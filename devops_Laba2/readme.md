Хорошие и плохие практики при написании Dockerfile

Цель работы
Целью лабораторной работы является изучение принципов контейнеризации приложений с использованием Docker, а также анализ плохих и хороших практик при написании Dockerfile и работе с контейнерами.

В рамках лабораторной работы были поставлены следующие задачи:
– написать «плохой» Dockerfile, содержащий не менее трёх bad practices;
– написать «хороший» Dockerfile, в котором данные ошибки исправлены;
– описать каждую плохую практику, объяснить, почему она является плохой, и показать, как она была исправлена;
– привести примеры плохих практик при работе с контейнерами.

В качестве примера использовалось простое веб-приложение на Python (Flask), файл laba2_app.py.

Используемое приложение
В рамках лабораторной работы использовалось минимальное Flask-приложение, которое запускает веб-сервер и возвращает текстовое сообщение при обращении к корневому маршруту. Приложение предназначено исключительно для демонстрации работы Docker и не содержит сложной бизнес-логики.

Плохой Dockerfile (Dockerfile.bad)
В «плохом» Dockerfile были намеренно использованы распространённые ошибки, которые часто допускаются при контейнеризации приложений.

Первая плохая практика — использование тега latest.
В плохом Dockerfile используется базовый образ с тегом latest. Использование latest не фиксирует конкретную версию образа. Это может привести к ситуации, когда сегодня контейнер собирается и работает корректно, а после обновления базового образа приложение перестаёт работать или ведёт себя непредсказуемо.

В хорошем Dockerfile используется фиксированная версия образа, что обеспечивает стабильность и предсказуемость сборки.

Вторая плохая практика — отсутствие оптимизации установки зависимостей.
В плохом Dockerfile зависимости устанавливаются без очистки кэша. Это приводит к увеличению размера итогового Docker-образа и ухудшает эффективность сборки.

В хорошем Dockerfile зависимости устанавливаются с очисткой кэша, что уменьшает размер образа и делает его более оптимальным.

Третья плохая практика — запуск контейнера от root.
Если в Dockerfile не указан пользователь, контейнер по умолчанию запускается от root. Это является плохой практикой с точки зрения безопасности, так как при компрометации приложения злоумышленник получает максимальные права внутри контейнера.

В хорошем Dockerfile применяется более безопасный подход к запуску контейнера.

Сборка плохого Dockerfile
<img width="2559" height="998" alt="image_2025-12-30_23-57-38" src="https://github.com/user-attachments/assets/1399c506-72bb-4888-8f43-cb44ad0e6eb0" />


Запуск контейнера из плохого образа
Контейнер, собранный из плохого Dockerfile, успешно запускается и корректно работает, несмотря на наличие плохих практик.

<img width="1476" height="191" alt="image_2025-12-31_00-02-15" src="https://github.com/user-attachments/assets/c5e58cc5-9986-4752-a4e4-53fb122073c4" />



Хороший Dockerfile (Dockerfile.good)
В хорошем Dockerfile были исправлены все выявленные ошибки. Используется фиксированная версия базового образа, зависимости устанавливаются с очисткой кэша, копируются только необходимые файлы нашего app.py.

В результате итоговый Docker-образ получился меньшего размера, более стабильным и удобным в эксплуатации.

Сборка хорошего Dockerfile
<img width="2554" height="728" alt="image_2025-12-30_23-57-44" src="https://github.com/user-attachments/assets/1951b3a2-adab-4a7c-84fb-bb100acbba0a" />

Запуск контейнера из хорошего образа
Контейнер, собранный из хорошего Dockerfile, успешно запускается с пробросом порта и корректно обрабатывает HTTP-запросы.

<img width="1496" height="224" alt="image_2025-12-31_00-06-00" src="https://github.com/user-attachments/assets/32909829-6a7d-4aae-878b-ded11efc00cc" />


Плохие практики при работе с контейнерами

Первая плохая практика — хранение данных внутри контейнера.
Контейнеры являются временными сущностями. Все данные, записанные внутрь контейнера, будут потеряны при его удалении или пересоздании. Для постоянных данных необходимо использовать Docker Volumes или внешние хранилища.

Вторая плохая практика — использование одного контейнера для нескольких задач.
Иногда контейнеры используют как полноценные виртуальные машины, запуская в одном контейнере сразу несколько сервисов. Это усложняет масштабирование, отладку и нарушает принцип единственной ответственности. Правильный подход — один контейнер выполняет одну задачу.

Выводы
В ходе лабораторной работы были рассмотрены основные плохие и хорошие практики при написании Dockerfile и работе с контейнерами. Даже такие простые ошибки, как использование тега latest, отсутствие оптимизации образа или запуск контейнера от root, могут негативно влиять на безопасность и стабильность приложения. Применение хороших практик позволяет создавать более надёжные, безопасные и удобные в эксплуатации контейнеры.
